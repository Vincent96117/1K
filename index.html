<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>1K EXPLOSION | V178 MONITOR</title>
    <style>
        body { background: #050505; color: #e0e0e0; font-family: sans-serif; padding: 15px; }
        .header { display: flex; gap: 20px; background: #111; padding: 15px; border-radius: 8px; border: 1px solid #333; margin-bottom: 15px; }
        .market-card { flex: 1; text-align: center; }
        .price { font-size: 22px; font-weight: bold; color: #f2a900; }
        .up { color: #00ff88; font-weight: bold; } .down { color: #ff3344; }
        table { width: 100%; border-collapse: collapse; background: #111; }
        th { background: #1a1a1a; color: #f2a900; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #222; }
        .trigger-tag { background: #ff3344; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; animation: blink 0.8s infinite; }
        .score-box { font-weight: bold; font-size: 18px; color: #f2a900; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
    </style>
</head>
<body>
    <div class="header">
        <div id="market-data" style="display:contents;"></div>
    </div>
    <h3>ğŸš€ ç¬æ™‚çˆ†ç™¼åå–® (1m å–®æ ¹æˆ–é›™æ ¹ > 1.5%)</h3>
    <table>
        <thead>
            <tr>
                <th>è§¸ç™¼æ™‚é–“</th>
                <th>å¹£ç¨®</th>
                <th>1m çˆ†ç™¼åŠ›</th>
                <th>V178 è©•åˆ†</th>
                <th>ç•¶å‰åƒ¹æ ¼</th>
            </tr>
        </thead>
        <tbody id="watchlist"></tbody>
    </table>

<script>
    const watchlistSymbols = new Set();
    let btcChange = 0;

    async function getMarket() {
        try {
            const res = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr?symbols=["BTCUSDT","ETHUSDT"]');
            const data = await res.json();
            let html = '';
            data.forEach(c => {
                if(c.symbol === "BTCUSDT") btcChange = parseFloat(c.priceChangePercent);
                html += `<div class="market-card"><h3>${c.symbol.replace('USDT','')}</h3><div class="price">${parseFloat(c.lastPrice).toLocaleString()}</div><div class="${parseFloat(c.priceChangePercent)>=0?'up':'down'}">${c.priceChangePercent}%</div></div>`;
            });
            document.getElementById('market-data').innerHTML = html;
        } catch(e) {}
    }

    async function scanExplosion() {
        try {
            const res = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
            const all = await res.json();
            // æ’é™¤ä½ ä¸æƒ³çœ‹çš„å¹£ç¨®
            const filtered = all.filter(c => !['BTCUSDT','ETHUSDT','SOLUSDT','XRPUSDT','BNBUSDT','BNXUSDT'].includes(c.symbol));
            // ç¸®å°ç¯„åœåˆ°æˆäº¤é‡å‰ 80 åï¼Œç¢ºä¿æœ‰æµå‹•æ€§
            const top80 = filtered.sort((a,b) => b.quoteVolume - a.quoteVolume).slice(0, 80);

            for (let coin of top80) {
                // æŠ“å–æœ€è¿‘ 2 æ ¹ 1m Kç·š
                const kRes = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${coin.symbol}&interval=1m&limit=2`);
                const k = await kRes.json();
                
                const k1_open = parseFloat(k[0][1]);
                const k1_close = parseFloat(k[0][4]);
                const k2_open = parseFloat(k[1][1]);
                const k2_close = parseFloat(k[1][4]);

                const k2_growth = ((k2_close - k2_open) / k2_open) * 100; // å–®æ ¹çˆ†ç™¼
                const double_k_growth = ((k2_close - k1_open) / k1_open) * 100; // é›™æ ¹çˆ†ç™¼

                // ç¯©é¸æ¢ä»¶ï¼šå–®æ ¹ > 1.5% æˆ– é›™æ ¹ > 1.5%
                if ((k2_growth >= 1.5 || double_k_growth >= 1.5) && !watchlistSymbols.has(coin.symbol)) {
                    watchlistSymbols.add(coin.symbol);
                    
                    // è¨ˆç®—é€²å…¥æ™‚çš„ V178 è©•åˆ† (ç›¸å°å¼·åº¦)
                    const rs = (parseFloat(coin.priceChangePercent) - btcChange) * 10;
                    const finalScore = Math.floor(rs + 20);

                    const row = `<tr id="row-${coin.symbol}">
                        <td style="color:#888">${new Date().toLocaleTimeString()}</td>
                        <td><b>${coin.symbol.replace('USDT','')}</b></td>
                        <td class="up">+${Math.max(k2_growth, double_k_growth).toFixed(2)}% <span class="trigger-tag">çˆ†ç™¼</span></td>
                        <td><span id="score-${coin.symbol}" class="score-box">${finalScore}</span></td>
                        <td id="price-${coin.symbol}">${coin.lastPrice}</td>
                    </tr>`;
                    document.getElementById('watchlist').insertAdjacentHTML('afterbegin', row);
                } else if (watchlistSymbols.has(coin.symbol)) {
                    // å¦‚æœå·²åœ¨åå–®ï¼Œæ›´æ–°åƒ¹æ ¼å’Œåˆ†æ•¸
                    document.getElementById(`price-${coin.symbol}`).innerText = coin.lastPrice;
                    const rs = (parseFloat(coin.priceChangePercent) - btcChange) * 10;
                    document.getElementById(`score-${coin.symbol}`).innerText = Math.floor(rs + 20);
                }
            }
        } catch(e) {}
    }

    setInterval(getMarket, 3000);
    setInterval(scanExplosion, 4000); // æ¯ 4 ç§’æƒæä¸€æ¬¡ï¼Œåæ‡‰æ›´å¿«
    getMarket(); scanExplosion();
</script>
</body>
</html>
